---
title: "Analysis of Bikeshare Data with chatGPT"
output:
  html_document:
    df_print: paged
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(message = F,
                      error = F, warning = F)
```
# Introduction

The purpose of this analysis is to use chatGPT as an assistant to produce a
predictive model for the bikeshare dataset. First we will import the Bikeshare
dataset into R as well as load packages for analysis.

```{r echo = TRUE, results = 'hide'}
library(tidyverse)
library(caret)
library(here)
library(knitr)
Bikeshare<- read_csv(here("inputs\\hour.csv"))
```

We can do some preliminary analysis of the model and what we might expect to be
good models of the bike rental counts.

```{r echo = FALSE}
head(Bikeshare)
```

We have some categorical variables in weathersit, which has 4 factors based on worsening weather conditions from clear, to mist, to light snow/rain, to heavy
snow/rain. And we have a season variable indicating the 4 different seasons.

```{r}
Bikeshare$cnt %>% sd()
Bikeshare$cnt %>% mean()
```

# Analysis with chatGPT

  For this analysis we are using GPT-4, the most recent and advanced model developed by OpenAI. We first establish that chatGPT is familiar with the Bikeshare data. And then begin to ask it followup questions in order to find potential model choices and
what reasons we may choose them.

```{r, echo = FALSE, out.width = '70%', fig.align = 'center'}
knitr::include_graphics(here("inputs\\Question1.png"))
knitr::include_graphics(here("inputs\\Question2a.png"))
knitr::include_graphics(here("inputs\\Question2b.png"))
knitr::include_graphics(here("inputs\\Question3a.png"))
knitr::include_graphics(here("inputs\\Question3b.png"))
```



We then ask chatGPT for suggestions on a predictive model for the Bikeshare
dataset. chatGPT gives provides a nice descriptive answer to the possible models one
could use it even suggest packages for implementing these different models
which are commonly used in R. I notice that although chatGPT
does mention linear regression, it does not mention poisson regression or negative binomial regression which seem to fit the distribution of the response variable in this case, a count of bike rentals, better then a normally distributed response
in linear regression.

chatGPT identifies poisson regression is designed for count data, and gives a
small example of how to implement it in R, we then ask that chatGPT fully
implement this model in R

```{r, echo = FALSE, out.width = '70%', fig.align = 'center'}

knitr::include_graphics(here("inputs\\Question4a.png"))
knitr::include_graphics(here("inputs\\Question4b.png"))
knitr::include_graphics(here("inputs\\Question4c.png"))
knitr::include_graphics(here("inputs\\Question4d.png"))


```

```{r}
# Load necessary libraries
library(tidyverse)

# Load the dataset
data <- read_csv(here("inputs\\day.csv"))

# Convert date to Date type
data$date <- as.Date(data$dteday)

# Remove unnecessary columns
data <- data %>% select(-instant, -dteday)

# Split the data into training and testing sets
set.seed(42)
train_indices <- sample(1:nrow(data), size = 0.8 * nrow(data))
train_data <- data[train_indices,]
test_data <- data[-train_indices,]
# Fit Poisson regression model
model <- glm(cnt ~ ., data = train_data, family = poisson())
summary(model)
# Make predictions
test_data$pred_count <- predict(model, newdata = test_data, type = "response")
# Calculate mean absolute error (MAE)
mae <- mean(abs(test_data$cnt - test_data$pred_count))
cat("Mean Absolute Error (MAE):", mae, "\n")

# Calculate root mean squared error (RMSE)
rmse <- sqrt(mean((test_data$cnt - test_data$pred_count)^2))
cat("Root Mean Squared Error (RMSE):", rmse, "\n")

```

Besides adjustments for importing the dataset this code runs perfectly well.
chatGPT performs a fairly basic validation and test split, performs no feature
feature selection but all the code runs and correctly reports the mean absolute deviation and mean squared deviation. chatGPT chose not to standardize the
predictors, so I ask why that may be?

```{r, echo = FALSE, out.width = '70%', fig.align = 'center'}

knitr::include_graphics(here("inputs\\Question5a.png"))
knitr::include_graphics(here("inputs\\Question5b.png"))
knitr::include_graphics(here("inputs\\Question6a.png"))
knitr::include_graphics(here("inputs\\Question6b.png"))

```

chatGPT gives us some code to standardize the predictors if we want and also
gives some explanation into why it may be unnecessary in this case.

chatGPT also gives us some advice on how we may improve the model, and I ask it
to demonstrate how to implement feature engineering in the case of the bikeshare dataset for use with our poisson regression model

```{r, echo = FALSE, out.width = '70%', fig.align = 'center'}
knitr::include_graphics(here("inputs\\Question7a.png"))
knitr::include_graphics(here("inputs\\Question7b.png"))
knitr::include_graphics(here("inputs\\Question7c.png"))

```

The cyclical encoding helps to ensure that our model recognizes that for example
January is closer to December then it is to April. It results in a minor improvement in the test performance MSE and MAE of our model.

```{r}
set.seed(42)
train_data$mnth_sin <- sin(2 * pi * train_data$mnth / 12)
train_data$mnth_cos <- cos(2 * pi * train_data$mnth / 12)

train_data$weekday_sin <- sin(2 * pi * train_data$weekday / 7)
train_data$weekday_cos <- cos(2 * pi * train_data$weekday / 7)

test_data$mnth_sin <- sin(2 * pi * test_data$mnth / 12)
test_data$mnth_cos <- cos(2 * pi * test_data$mnth / 12)

test_data$weekday_sin <- sin(2 * pi * test_data$weekday / 7)
test_data$weekday_cos <- cos(2 * pi * test_data$weekday / 7)
# Fit Poisson regression model
model <- glm(cnt ~ . -mnth -weekday, data = train_data, family = poisson())
summary(model)
# Make predictions
test_data$pred_count <- predict(model, newdata = test_data, type = "response")
# Calculate mean absolute error (MAE)
mae <- mean(abs(test_data$cnt - test_data$pred_count))
cat("Mean Absolute Error (MAE):", mae, "\n")

# Calculate root mean squared error (RMSE)
rmse <- sqrt(mean((test_data$cnt - test_data$pred_count)^2))
cat("Root Mean Squared Error (RMSE):", rmse, "\n")

```

